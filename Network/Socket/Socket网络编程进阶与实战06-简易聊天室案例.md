# 简易聊天室案例

---
## 1 聊天室设计

- 必要条件：客户端、服务器
- 必要约束：数据传输协议。
- 原理：服务器监听消息来源，客户端连接服务器并发送消息到服务器。

数据传输协议：使用换行符协议（一旦读取到换行符，就认为这是一条完整的消息）。

![](index_files/snipaste_20181104_001105.png)

服务器客户端模型：服务器作为消息的中转站。

![](index_files/snipaste_20181104_001259.png)

---
## 2 代码实现

[示例代码](https://github.com/Ztiany/Programming-Notes-Code/tree/master/Java/Java-Socket/src/main/java/immoc/socket/l6)

---
## 3 服务器状态与测试用例构建

- 每个客户端都需要服务器进行双通等待。
- 双通：客户端发送数据到服务器的接收通道，服务器回送消息的发送通道。每条通道因为阻塞只能使用异步线程实现。
- 服务器线程数量：一个客户端需要 2 个线程，n 个客户端需要 `2*n+` 线程。

测试用例：

- 工具：JConsole、Java Visual VM