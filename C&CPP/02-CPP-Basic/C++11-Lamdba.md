# Lambda 函数与表达式

C++11 提供了对匿名函数的支持，称为 Lambda 函数(也叫 Lambda 表达式)。Lambda 表达式把函数看作对象。Lambda 表达式可以像对象一样使用，比如可以将它们赋给变量和作为参数传递，还可以像函数一样对其求值。

Lambda 表达式本质上与函数声明非常类似。Lambda 表达式具体形式是：

- `[capture](parameters)->return-type{body}`
- `[capture](parameters){body}` 没有返回值类型

示例：

```cpp
// [&] 表示外部变量都以引用的形式在 lambda 中使用，函数内部修改i的值会影响外部
thread t1([&] () -> auto {//这里的 -> auto 自动推导在c++11不支持，c++14中对auto进行了扩展
    i = 100;
    cout << "线程:" << i  << endl;
});

[](int x, int y){ return x < y ; }

[]{ ++global_x; }

[](int x, int y) -> int { int z = x + y; return z + x; }
```

在 Lambda 表达式内可以访问当前作用域的变量，这是 Lambda 表达式的闭包（Closure）行为。C++ 闭包变量传递有传值和传引用的区别。可以通过前面的 `[]` 来指定：

| 捕获形式 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| `[]`       | 不捕获任何外部变量                                           |
| `[i, …]`   | 以值得形式捕获指定的多个外部变量（用逗号分隔）；如果引用捕获，需要显示声明& |
| `[this]`   | 以值的形式捕获this指针                                       |
| `[=]`      | 以值的形式捕获所有外部变量                                   |
| `[&]`      | 以引用形式捕获所有外部变量                                   |
| `[=, &x]`  | 变量x以引用形式捕获，其余变量以传值形式捕获                  |
| `[&, x]`   | 变量x以值的形式捕获，其余变量以引用形式捕获                  |

对于`*[=]`或`[&]*`的形式，lambda 表达式可以直接使用 this 指针。但是，对于`*[]*`的形式，如果要使用 this 指针，必须显式传入：

```cpp
[this]() { this->someFunc(); }();
```
