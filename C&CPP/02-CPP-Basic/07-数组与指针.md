# C++数组与指针

---
## 1 数组

数组（array）是一种数据格式，能够存储多个同类型的值，具有以下特性：

- 数组是大小确定的容器，只有在定义数组时才能使用初始化，此后就不能使用了，也不能将一个数组赋值给另一个数组。
- 使用数组的时候，编译器一般会把它转换为指针，数组名就表示一个指针。
- 指针也是迭代器，通过指针可以迭代数组中的元素
- c++提供了库函数 `begin(array)和end(array)` 来获取首元素指针和尾元素指针。
- 访问数组的索引应该使用`size_t`类型
- 两个指针相减的结果是`ptrdiff_t`类型

### 数组初始化

常规初始化：

```cpp
 int size = 3;
int const cSize = 10;
int arr1[size];
int arr2[] = {1, 2, 3};
int arr3[5] = {1, 2, 3};
int arr4[cSize];
```

C++11 将使用大括号的初始化（列表初始化）作为一种通用初始化方式，可用于所有类型。数组以前就可使用列表初始化，但 C++11 中的列表初始化新增了一些功能：

```cpp
//初始化数组时，可省略等号（=）
int arr5[3] {1,2,3};
//可不在大括号内包含任何东西，这将把所有元素都设置为零。
int arr6[3] {};//所有元素都为0。
int arr7[3] {1};//第一个元素为1，其他为0。
// 列表初始化禁止缩窄转换
char chars[4] {'h', 'i', 12312223, '\0'};// 不允许，12312223超出 char 的范围。
```

### 元素的初始化规则

如果没有显式提供元素初值，则数组元素会像普通变量一样初始化。

- 在函数体外定义的内置数组，其元素均初始化为 0。
- 在函数体内定义的内置数组，其元素无初始化，其值是未知的，取决于编译器，即使元素被初始化为 0，也不应该依赖这种行为。
- 不管数组在哪里定义，如果其元素为类类型，则自动调用该类的默认构造函数进行初始化；如果该类没有默认构造函数，则必须为该数组的元素提供显式初始化。

### 数组不允许数组直接复制和赋值

与 vector 不同，一个数组不能用另外一个数组初始化，也不能将一个数组赋值给另一个数组，这些操作都是非法的。

### 避免缓冲区溢出

导致安全问题的最常见原因是所谓“缓冲区溢出（buffer overflow）”错误。当我们在编程时没有检查数组下标，并且引用了越出数组或其他类似数据结构边界的元素时，就会导致这类错误。

---
## 2 指针

指针的概念很简单：指针用于指向对象。与迭代器一样，指针提供对其所指对象的间接访问，只是指针结构更通用一些。与迭代器不同的是，指针用于指向单个对象，而迭代器只能用于访问容器内的元素。具体来说，**指针保存的是另一个对象的地址**。

```cpp
ing s("hello world");
string *sp = &s;
```

关于指针初始化：

- C++ 语言无法检测指针是否未被初始化，也无法区分有效地址和由指针分配到的存储空间中存放的二进制位形成的地址。建议程序员在使用之前初始化所有的变量，尤其是指针。 如果可能的话，除非所指向的对象已经存在，否则不要先定义指针，这样可避免定义一个未初始化的指针。
- 如果必须分开定义指针和其所指向的对象，则将指针初始化为 0。因为编译器可检测出 0 值的指针，程序可判断该指针并未指向一个对象。

`void*` 指针：

- C++ 提供了一种特殊的指针类型 `void*`，它可以保存任何类型对象的地址。`void*` 表明该指针与一地址值相关，但不清楚存储在此地址上的对象的类型。
- `void*` 指针只支持几种有限的操作：与另一个指针进行比较；向函数传递 `void*` 指针或从函数返回 `void*` 指针；给另一个 `void*` 指针赋值。不允许使用 `void*` 指针操纵它所指向的对象。

## 3 避免使用低级复合类型

在 C++ 中，数组和指针被归于低级复合类型，相比标准库中提供的工具，它们使用并不方便，且易出现操作错误：**现代 C++ 程序应尽量使用 vector 和迭代器类型，而避免使用低级的数组和指针。设计良好的程序只有在强调速度时才在类实现的内部使用数组和指针**。

- 与 vector 类型相比，数组的显著缺陷在于：数组的长度是固定的，而且程序员无法知道一个给定数组的长度。数组没有获取其容量大小的 size 操作，也不提供 push_back 操作在其中自动添加元素。如果需要更改数组的长度，程序员只能创建一个更大的新数组，然后把原数组的所有元素复制到新数组空间中去。 与使用标准 vector 类型的程序相比，依赖于内置数组的程序更容易出错而且难于调试。
- 指针用于低级操作，容易产生与繁琐细节相关的（bookkeeping）错误。其他错误则源于使用指针的语法规则，特别是声明指针的语法。 许多有用的程序都可不使用数组或指针实现，现代 C++ 程序采用 vector 类型和迭代器取代一般的数组、采用 string 类型取代 C 风格字符串。
