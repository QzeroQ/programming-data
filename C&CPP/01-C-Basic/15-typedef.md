# typedef

## typedef 的作用

typedef 可以指定新的类型名来代替已有的类型名，目的是为了使源代码更易于阅读和理解。习惯把 typedef 声明的类型的第一次字母大写。

定义一个新的类型的方法是：

1. 先按定义变量的方法写出定义体(int a)
2. 将变量名换成新的类型名(Count)
3. 在最前面加上typedef(typedef Count)
4. 然后可以用新的类型名去定义变量

```c
//给int定义一个Integer名称。
typedef int Integer
//定义一个函数指针。
typedef void (*__p_sig_fn_t)(int);
```

## typedef和 `#define` 的区别

把 typedef 看成一种彻底的“封装”类型，声明之后不能再往里面增加别的东西。

- 1 可以使用其他类型说明符对宏类型名进行扩展，但对 typedef 所定义的类型名却不能这样做。

```c
#define INTERGE int
unsigned INTERGE n; //没问题

typedef int INTERGE;
unsigned INTERGE n; //错误，不能在 INTERGE 前面添加 unsigned
```

- 2 在连续定义几个变量的时候，typedef 能够保证定义的所有变量均为同一类型，而 #define 则无法保证。

```c
#define PTR_INT int *
PTR_INT p1, p2;
//经过宏替换以后
int *p1, p2;

typedef int * PTR_INT
PTR_INT p1, p2//p1、p2 类型相同，它们都是指向 int 类型的指针。
```

- 3 与 #define 不同，typedef 创建的符号名只受限于类型，不能用于值。

- 4 typedef 与 define 表面上有相似之处，但是本质不一样，define 在预编译时处理，而 typedef 在编译时处理。

## 复杂的类型声明

C允许用户自定义数据形式。虽然我们常用的是一些简单的形式，但是根据需要有时还会用到一些复杂的形式。在一些复杂的声明中，常包含下面的符号：

- `*` 表示一个指针
- `()` 表示一个函数
- `[]` 表示一个数组

要看懂复杂的声明，关键要理解 `*`、`()` 和`[]` 的优先级。记住下面几条规则。

- 1 数组名后面的 `[]` 和函数名后面的`()` 具有相同的优先级。它们比 *（解引用运算符）的优先级高。因此下面声明的 risk 是一个指针数组，不是指向数组的指针：

```c
//risks[10] 先组合，然后左边的类型是 int*。
int * risks[10];
```

- 2．`[]` 和 `()` 的优先级相同，由于都是从左往右结合，所以下面的声明中，在应用方括号之前，`*`先与 rusks 结合。因此 rusks 是一个指向数组的指针，该数组内含 10 个 int 类型的元素：

```c
//(* rusks) 先组合，是个指针，剩下了 int[10]，所以 rusks 是一个指向数组的指针。
int (* rusks)[10];
```

- 3．`[]` 和 `()` 都是从左往右结合。

```c
//从左往右结合，因此下面声明的 goods 是一个由 12 个内含 50 个 int 类型值的数组组成的二维数组，不是一个有 50 个内含 12 个 int 类型值的数组组成的二维数组。
int goods[12][50];

//[3] 比*的优先级高，由于从左往右结合，所以 [3] 先与 oof 结合。因此，oof 首先是一个内含3个元素的数组。
//然后再与[4] 结合，所以 oof 的每个元素都是内含4 个元素的数组。* 说明这些元素都是指针。最后，int 表明了这 4 个元素都是指向 int 的指针。
//因此，这条声明要表达的是：foo 是一个内含3个元素的数组，其中每个元素是由4个指向int 的指针组成的数组。
//简而言之，oof 是一个3×4的二维数组，每个元素都是指向int 的指针。编译器要为12个指针预留存储空间。
int * oof[3][4];

//圆括号使得*先与uuf 结合，说明uuf 是一个指针，所以uuf 是一个指向3×4的int 类型二维数组的指针。编译器要为一个指针预留存储空间。
int (* uuf)[3][4];
```

下面是一些示例：

```c
int board[8][8];      // 声明一个内含int数组的数组

int ** ptr;           // 声明一个指向指针的指针，被指向的指针指向int
int * risks[10];      // 声明一个内含10个元素的数组，每个元素都是一个指向int的指针
int (* rusks)[10];    // 声明一个指向数组的指针，该数组内含10个int类型的值
int * oof[3][4];      // 声明一个3×4 的二维数组，每个元素都是指向int的指针
int (* uuf)[3][4];    // 声明一个指向3×4二维数组的指针，该数组中内含int类型值
int (* uof[3])[4];    // 声明一个内含3个指针元素的数组，其中每个指针都指向一个内含4个int类型元素的数组

char * fump(int);            // 返回字符指针的函数
char (* frump)(int);         // 指向函数的指针，该函数的返回类型为char
char (* flump[3])(int);      // 内含3个指针的数组，每个指针都指向返回类型为char的函数

int (*f(int, int))(int);    //f 本身是一个函数，其有两个 int 类型的参数，该函数返回一个指针，该指针指向具有一个参数为 int 类型，返回类型为int的函数

typedef int arr5[5];        // 一个内含5个int类型值的数组
typedef arr5 * p_arr5;      //一个指向数组的指针，该数组内含5个int类型的值
typedef p_arr5 arrp10[10];  //一个内含10个指针的数组，每个指针都指向一个内含5个int类型值的数组
```
