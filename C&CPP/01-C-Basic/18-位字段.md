# 位字段

## 简介

使用位域可以更好的利用内存空间。 位域声明：

```c
 struct
    {
      type [member_name] : width ;
    };
```

- ``type``：整数类型，决定了如何解释位域的值。类型可以是整型、有符号整型、无符号整型。
- ``member_name``：位域的名称。
- ``width``：位域中位的数量。宽度必须小于或等于指定类型的位宽度。

关于位域有以下特点：

- 一个位域必须存储在同一个字节中，不能跨两个字节。如一个字节所剩空间不够存放另一位域时，应从下一单元起存放该位域。也可以有意使某位域从下一单元开始。
- 由于位域不允许跨两个字节，因此位域的长度不能大于一个字节的长度。
- 位域可以无位域名，这时它只用来作填充或调整位置。无名的位域是不能使用的。

```c
//这里，在stuff.field1 和stuff.field2 之间，有一个2位的空隙；stuff.field3 将储存在下一个unsigned int 中。
struct {
    unsigned int field1     : 1 ;
    unsigned int            : 2 ;
    unsigned int field2     : 1 ;
    unsigned int            : 0 ;
    unsigned int field3     : 1 ;
} stuff;

```

## 可移植性

字段储存在一个 int 中的顺序取决于机器。在有些机器上，存储的顺序是从左往右，而在另一些机器上，是从右往左。另外，不同的机器中两个字段边界的位置也有区别。由于这些原因，位字段通常都不容易移植。尽管如此，有些情况却要用到这种不可移植的特性。例如，以特定硬件设备所用的形式储存数据。

## 位字段示例

例如，假设要在屏幕上表示一个方框的属性。为简化问题，我们假设方框具有如下属性：

- 方框是透明的或不透明的；
- 方框的填充色选自以下调色板：黑色、红色、绿色、黄色、蓝色、紫色、青色或白色；
- 边框可见或隐藏；
- 边框颜色与填充色使用相同的调色板；
- 边框可以使用实线、点线或虚线样式。

方案：可以使用单独的变量或全长（full-sized ）结构成员来表示每个属性，但是这样做有些浪费位。采用位字段则比较省空间：

- 只需1 位即可表示方框是透明还是不透明；
- 只需1位即可表示边框是显示还是隐藏。
- 8种颜色可以用3位单元的8个可能的值来表示，
- 3种边框样式也只需2位单元即可表示。

总共10位就足够表示方框的5个属性设置：

```c
struct box_props {
    bool opaque                   : 1 ;
    unsigned int fill_color       : 3 ;
    unsigned int                  : 4 ;
    bool show_border              : 1 ;
    unsigned int border_color     : 3 ;
    unsigned int border_style     : 2 ;
    unsigned int                  : 2 ;
};
```
